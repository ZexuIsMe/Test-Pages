<div class="index-menu px-4">
    <div id="no-mobile-menu" >
        <div class="d-flex justify-center align-center gap-4 v-full">
            <% Object.keys(theme.menu).forEach(key => { %>
                <div>
                    <a
                            style="color: <%= page.title === '碧海苍云录' ? '#fff' : '#00586d' %>"
                            href="<%= theme.menu[key] %>"
                    ><%= key %></a>
                </div>
            <% }) %>
        </div>
    </div>
    <div id="mobile-menu">
        <div class="v-full d-flex justify-end align-center">
            <div style="width: fit-content; position: relative">
                <i
                        class="fas fa-list"
                        style="color: <%= page.title === '碧海苍云录' ? '#fff' : '#00586d' %>"
                        onclick="event.stopPropagation(); menuEjs.onclickMobileMenu(event)"
                ></i>
                <div
                        id="nav-mobile"
                        class="py-4"
                        style=" opacity: 0; visibility: hidden"
                        onclick="event.stopPropagation();"
                >
                    <aside class="menu">
                        <% Object.keys(theme.menu).forEach(key => { %>
                            <%
                                let active = false
                                const menuPath = theme.menu[key];
                                if (menuPath === '/' && page.path === 'index.html') {
                                    active = true
                                } else if (!['/', '/archives'].find(value => value === menuPath) && ('/'+page.path).startsWith(menuPath)) {
                                    active = true
                                } if (menuPath === '/archives' && ['tags', 'categories', 'archives'].find(item => page.path.startsWith(item))) {
                                active = true
                            }
                            %>
                            <div
                                    class="px-8 menu-label d-flex align-center
                                    <%= active ? 'v-bg-primary' : '' %>"
                                    style="text-wrap: nowrap; font-size: 24px; height: 48px; margin: 0"
                            >
                                <a href="<%= theme.menu[key] %>" style="color: <%= active ? '#EEE' : '#00586d' %> "><%= key %></a>
                            </div>
                        <% }) %>
                    </aside>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .menu-label:hover {
        background-color: #EEEEEE;
        color: #00586d;
    }
</style>

<script>
    // 导航栏吸顶功能实现
    document.addEventListener('DOMContentLoaded', function() {
        const navbar = document.querySelector('.index-menu');
        let lastScrollTop = 0;
        const threshold = 50; // 滚动阈值，越小越敏感

        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            // 页面顶部始终显示
            if (scrollTop <= threshold) {
                navbar.classList.remove('fixed-header-hidden');
            }
            // 向下滚动且超过阈值
            else if (scrollTop > lastScrollTop && scrollTop > threshold) {
                navbar.classList.add('fixed-header-hidden');
            }
            // 向上滚动
            else {
                navbar.classList.remove('fixed-header-hidden');
            }

            lastScrollTop = scrollTop;

            // 无论是向上还是向下滚动，如果音乐播放器处于展现状态，都要收起来
            const musicPlayer = document.getElementById('music-player')
            if(musicPlayer) musicPlayer.style.left = -100 + '%'
        });
    });

    const menuEjs = {
        onclickMobileMenu: event => {
            console.log('onclickMobileMenu')
            const targetDOM = document.getElementById('nav-mobile')
            targetDOM.style.opacity = 1
            targetDOM.style.visibility = 'visible'
        }
    }

    window.addEventListener('click', function() {
        const targetDOM = document.getElementById('nav-mobile')
        if (!targetDOM || !targetDOM.style.opacity) return
        if (targetDOM.style.opacity) {
            targetDOM.style.opacity = 0
            targetDOM.style.visibility = 'hidden'
        }
    })
</script>

<style>
    .index-menu {
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        height: 100px;
        backdrop-filter: blur(10px);
        background-color: transparent;
        z-index: 99999;
        transition: transform 0.3s linear, opacity 0.3s linear; /* 线性过渡 */
    }
    .index-menu > div {
        cursor: pointer;
    }

    .fixed-header-hidden {
        transform: translateY(-100%);
        opacity: 0;
    }
    #no-mobile-menu {
        display: none;
        width: 100%;
    }
    #mobile-menu {
        display: none;
        height: 100%;
    }
    #nav-mobile {
        transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
        position: absolute;
        top: 100%;
        background-color: white;
        z-index: 2;
        right: 0;
    }

    /* 屏幕宽度小于等于400px时 */
    @media (max-width: 400px) {
        #mobile-menu {
            display: block;
        }
        #no-mobile-menu {
            display: none;
        }
    }

    /* 屏幕宽度大于400px时 */
    @media (min-width: 401px) {
        #mobile-menu {
            display: none;
        }
        #no-mobile-menu {
            display: block;
        }
    }
</style>